<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <title>README</title>
      <style>.markdown-preview:not([data-use-github-style]) { padding: 2em; font-size: 1.2em; color: rgb(248, 248, 242); overflow: auto; background-color: rgb(40, 40, 40); }
.markdown-preview:not([data-use-github-style]) > :first-child { margin-top: 0px; }
.markdown-preview:not([data-use-github-style]) h1, .markdown-preview:not([data-use-github-style]) h2, .markdown-preview:not([data-use-github-style]) h3, .markdown-preview:not([data-use-github-style]) h4, .markdown-preview:not([data-use-github-style]) h5, .markdown-preview:not([data-use-github-style]) h6 { line-height: 1.2; margin-top: 1.5em; margin-bottom: 0.5em; color: rgb(255, 255, 255); }
.markdown-preview:not([data-use-github-style]) h1 { font-size: 2.4em; font-weight: 300; }
.markdown-preview:not([data-use-github-style]) h2 { font-size: 1.8em; font-weight: 400; }
.markdown-preview:not([data-use-github-style]) h3 { font-size: 1.5em; font-weight: 500; }
.markdown-preview:not([data-use-github-style]) h4 { font-size: 1.2em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) h5 { font-size: 1.1em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) h6 { font-size: 1em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) strong { color: rgb(255, 255, 255); }
.markdown-preview:not([data-use-github-style]) del { color: rgb(219, 219, 189); }
.markdown-preview:not([data-use-github-style]) a, .markdown-preview:not([data-use-github-style]) a code { color: rgb(248, 248, 240); }
.markdown-preview:not([data-use-github-style]) img { max-width: 100%; }
.markdown-preview:not([data-use-github-style]) > p { margin-top: 0px; margin-bottom: 1.5em; }
.markdown-preview:not([data-use-github-style]) > ul, .markdown-preview:not([data-use-github-style]) > ol { margin-bottom: 1.5em; }
.markdown-preview:not([data-use-github-style]) blockquote { margin: 1.5em 0px; font-size: inherit; color: rgb(219, 219, 189); border-color: rgb(81, 81, 81); border-width: 4px; }
.markdown-preview:not([data-use-github-style]) hr { margin: 3em 0px; border-top: 2px dashed rgb(81, 81, 81); background: none; }
.markdown-preview:not([data-use-github-style]) table { margin: 1.5em 0px; }
.markdown-preview:not([data-use-github-style]) th { color: rgb(255, 255, 255); }
.markdown-preview:not([data-use-github-style]) th, .markdown-preview:not([data-use-github-style]) td { padding: 0.66em 1em; border: 1px solid rgb(81, 81, 81); }
.markdown-preview:not([data-use-github-style]) code { color: rgb(255, 255, 255); background-color: rgb(60, 60, 60); }
.markdown-preview:not([data-use-github-style]) pre.editor-colors { margin: 1.5em 0px; padding: 1em; font-size: 0.92em; border-radius: 3px; background-color: rgb(50, 50, 50); }
.markdown-preview:not([data-use-github-style]) kbd { color: rgb(255, 255, 255); border-width: 1px 1px 2px; border-style: solid; border-color: rgb(81, 81, 81) rgb(81, 81, 81) rgb(66, 66, 66); background-color: rgb(60, 60, 60); }
.markdown-preview[data-use-github-style] { font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif; line-height: 1.6; word-wrap: break-word; padding: 30px; font-size: 16px; color: rgb(51, 51, 51); overflow: scroll; background-color: rgb(255, 255, 255); }
.markdown-preview[data-use-github-style] > :first-child { margin-top: 0px !important; }
.markdown-preview[data-use-github-style] > :last-child { margin-bottom: 0px !important; }
.markdown-preview[data-use-github-style] a:not([href]) { color: inherit; text-decoration: none; }
.markdown-preview[data-use-github-style] .absent { color: rgb(204, 0, 0); }
.markdown-preview[data-use-github-style] .anchor { position: absolute; top: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; }
.markdown-preview[data-use-github-style] .anchor:focus { outline: none; }
.markdown-preview[data-use-github-style] h1, .markdown-preview[data-use-github-style] h2, .markdown-preview[data-use-github-style] h3, .markdown-preview[data-use-github-style] h4, .markdown-preview[data-use-github-style] h5, .markdown-preview[data-use-github-style] h6 { position: relative; margin-top: 1em; margin-bottom: 16px; font-weight: bold; line-height: 1.4; }
.markdown-preview[data-use-github-style] h1 .octicon-link, .markdown-preview[data-use-github-style] h2 .octicon-link, .markdown-preview[data-use-github-style] h3 .octicon-link, .markdown-preview[data-use-github-style] h4 .octicon-link, .markdown-preview[data-use-github-style] h5 .octicon-link, .markdown-preview[data-use-github-style] h6 .octicon-link { display: none; color: rgb(0, 0, 0); vertical-align: middle; }
.markdown-preview[data-use-github-style] h1:hover .anchor, .markdown-preview[data-use-github-style] h2:hover .anchor, .markdown-preview[data-use-github-style] h3:hover .anchor, .markdown-preview[data-use-github-style] h4:hover .anchor, .markdown-preview[data-use-github-style] h5:hover .anchor, .markdown-preview[data-use-github-style] h6:hover .anchor { padding-left: 8px; margin-left: -30px; text-decoration: none; }
.markdown-preview[data-use-github-style] h1:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h2:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h3:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h4:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h5:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h6:hover .anchor .octicon-link { display: inline-block; }
.markdown-preview[data-use-github-style] h1 tt, .markdown-preview[data-use-github-style] h2 tt, .markdown-preview[data-use-github-style] h3 tt, .markdown-preview[data-use-github-style] h4 tt, .markdown-preview[data-use-github-style] h5 tt, .markdown-preview[data-use-github-style] h6 tt, .markdown-preview[data-use-github-style] h1 code, .markdown-preview[data-use-github-style] h2 code, .markdown-preview[data-use-github-style] h3 code, .markdown-preview[data-use-github-style] h4 code, .markdown-preview[data-use-github-style] h5 code, .markdown-preview[data-use-github-style] h6 code { font-size: inherit; }
.markdown-preview[data-use-github-style] h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
.markdown-preview[data-use-github-style] h1 .anchor { line-height: 1; }
.markdown-preview[data-use-github-style] h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
.markdown-preview[data-use-github-style] h2 .anchor { line-height: 1; }
.markdown-preview[data-use-github-style] h3 { font-size: 1.5em; line-height: 1.43; }
.markdown-preview[data-use-github-style] h3 .anchor { line-height: 1.2; }
.markdown-preview[data-use-github-style] h4 { font-size: 1.25em; }
.markdown-preview[data-use-github-style] h4 .anchor { line-height: 1.2; }
.markdown-preview[data-use-github-style] h5 { font-size: 1em; }
.markdown-preview[data-use-github-style] h5 .anchor { line-height: 1.1; }
.markdown-preview[data-use-github-style] h6 { font-size: 1em; color: rgb(119, 119, 119); }
.markdown-preview[data-use-github-style] h6 .anchor { line-height: 1.1; }
.markdown-preview[data-use-github-style] p, .markdown-preview[data-use-github-style] blockquote, .markdown-preview[data-use-github-style] ul, .markdown-preview[data-use-github-style] ol, .markdown-preview[data-use-github-style] dl, .markdown-preview[data-use-github-style] table, .markdown-preview[data-use-github-style] pre { margin-top: 0px; margin-bottom: 16px; }
.markdown-preview[data-use-github-style] hr { height: 4px; padding: 0px; margin: 16px 0px; border: 0px none; background-color: rgb(231, 231, 231); }
.markdown-preview[data-use-github-style] ul, .markdown-preview[data-use-github-style] ol { padding-left: 2em; }
.markdown-preview[data-use-github-style] ul.no-list, .markdown-preview[data-use-github-style] ol.no-list { padding: 0px; list-style-type: none; }
.markdown-preview[data-use-github-style] ul ul, .markdown-preview[data-use-github-style] ul ol, .markdown-preview[data-use-github-style] ol ol, .markdown-preview[data-use-github-style] ol ul { margin-top: 0px; margin-bottom: 0px; }
.markdown-preview[data-use-github-style] li > p { margin-top: 16px; }
.markdown-preview[data-use-github-style] dl { padding: 0px; }
.markdown-preview[data-use-github-style] dl dt { padding: 0px; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold; }
.markdown-preview[data-use-github-style] dl dd { padding: 0px 16px; margin-bottom: 16px; }
.markdown-preview[data-use-github-style] blockquote { padding: 0px 15px; color: rgb(119, 119, 119); border-left: 4px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] blockquote > :first-child { margin-top: 0px; }
.markdown-preview[data-use-github-style] blockquote > :last-child { margin-bottom: 0px; }
.markdown-preview[data-use-github-style] table { display: block; width: 100%; overflow: auto; word-break: keep-all; }
.markdown-preview[data-use-github-style] table th { font-weight: bold; }
.markdown-preview[data-use-github-style] table th, .markdown-preview[data-use-github-style] table td { padding: 6px 13px; border: 1px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] table tr { border-top: 1px solid rgb(204, 204, 204); background-color: rgb(255, 255, 255); }
.markdown-preview[data-use-github-style] table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
.markdown-preview[data-use-github-style] img { max-width: 100%; box-sizing: border-box; }
.markdown-preview[data-use-github-style] .emoji { max-width: none; }
.markdown-preview[data-use-github-style] span.frame { display: block; overflow: hidden; }
.markdown-preview[data-use-github-style] span.frame > span { display: block; float: left; width: auto; padding: 7px; margin: 13px 0px 0px; overflow: hidden; border: 1px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] span.frame span img { display: block; float: left; }
.markdown-preview[data-use-github-style] span.frame span span { display: block; padding: 5px 0px 0px; clear: both; color: rgb(51, 51, 51); }
.markdown-preview[data-use-github-style] span.align-center { display: block; overflow: hidden; clear: both; }
.markdown-preview[data-use-github-style] span.align-center > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: center; }
.markdown-preview[data-use-github-style] span.align-center span img { margin: 0px auto; text-align: center; }
.markdown-preview[data-use-github-style] span.align-right { display: block; overflow: hidden; clear: both; }
.markdown-preview[data-use-github-style] span.align-right > span { display: block; margin: 13px 0px 0px; overflow: hidden; text-align: right; }
.markdown-preview[data-use-github-style] span.align-right span img { margin: 0px; text-align: right; }
.markdown-preview[data-use-github-style] span.float-left { display: block; float: left; margin-right: 13px; overflow: hidden; }
.markdown-preview[data-use-github-style] span.float-left span { margin: 13px 0px 0px; }
.markdown-preview[data-use-github-style] span.float-right { display: block; float: right; margin-left: 13px; overflow: hidden; }
.markdown-preview[data-use-github-style] span.float-right > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: right; }
.markdown-preview[data-use-github-style] code, .markdown-preview[data-use-github-style] tt { padding: 0.2em 0px; margin: 0px; font-size: 85%; border-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157); }
.markdown-preview[data-use-github-style] code::before, .markdown-preview[data-use-github-style] tt::before, .markdown-preview[data-use-github-style] code::after, .markdown-preview[data-use-github-style] tt::after { letter-spacing: -0.2em; content: " "; }
.markdown-preview[data-use-github-style] code br, .markdown-preview[data-use-github-style] tt br { display: none; }
.markdown-preview[data-use-github-style] del code { text-decoration: inherit; }
.markdown-preview[data-use-github-style] pre > code { padding: 0px; margin: 0px; font-size: 100%; word-break: normal; white-space: pre; border: 0px; background: transparent; }
.markdown-preview[data-use-github-style] .highlight { margin-bottom: 16px; }
.markdown-preview[data-use-github-style] .highlight pre, .markdown-preview[data-use-github-style] pre { padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45; border-radius: 3px; background-color: rgb(247, 247, 247); }
.markdown-preview[data-use-github-style] .highlight pre { margin-bottom: 0px; word-break: normal; }
.markdown-preview[data-use-github-style] pre { word-wrap: normal; }
.markdown-preview[data-use-github-style] pre code, .markdown-preview[data-use-github-style] pre tt { display: inline; max-width: initial; padding: 0px; margin: 0px; overflow: initial; line-height: inherit; word-wrap: normal; border: 0px; background-color: transparent; }
.markdown-preview[data-use-github-style] pre code::before, .markdown-preview[data-use-github-style] pre tt::before, .markdown-preview[data-use-github-style] pre code::after, .markdown-preview[data-use-github-style] pre tt::after { content: normal; }
.markdown-preview[data-use-github-style] kbd { display: inline-block; padding: 3px 5px; font-size: 11px; line-height: 10px; color: rgb(85, 85, 85); vertical-align: middle; border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(187, 187, 187); border-radius: 3px; box-shadow: rgb(187, 187, 187) 0px -1px 0px inset; background-color: rgb(252, 252, 252); }
.markdown-preview[data-use-github-style] a { color: rgb(51, 122, 183); }
.markdown-preview[data-use-github-style] code { color: inherit; }
.markdown-preview[data-use-github-style] pre.editor-colors { padding: 0.8em 1em; margin-bottom: 1em; font-size: 0.85em; border-radius: 4px; overflow: auto; }
.scrollbars-visible-always .markdown-preview pre.editor-colors .vertical-scrollbar, .scrollbars-visible-always .markdown-preview pre.editor-colors .horizontal-scrollbar { visibility: hidden; }
.scrollbars-visible-always .markdown-preview pre.editor-colors:hover .vertical-scrollbar, .scrollbars-visible-always .markdown-preview pre.editor-colors:hover .horizontal-scrollbar { visibility: visible; }
.markdown-preview .task-list-item-checkbox { position: absolute; margin: 0.25em 0px 0px -1.4em; }
.bracket-matcher .region {
  border-bottom: 1px dotted lime;
  position: absolute;
}

.spell-check-misspelling .region {
  border-bottom: 2px dotted rgba(255, 51, 51, 0.75);
}
.spell-check-corrections {
  width: 25em !important;
}

pre.editor-colors {
  background-color: #282828;
  color: #F8F8F2;
}
pre.editor-colors .invisible-character {
  color: rgba(197, 200, 198, 0.2);
}
pre.editor-colors .indent-guide {
  color: rgba(255, 255, 255, 0.15);
}
pre.editor-colors .wrap-guide {
  background-color: rgba(255, 255, 255, 0.1);
}
pre.editor-colors .gutter {
  background-color: #303030;
}
pre.editor-colors .line-number.cursor-line-no-selection {
  background-color: #49483E;
}
pre.editor-colors .invisible {
  color: #F8F8F2;
}
pre.editor-colors .cursor {
  border-color: #F8F8F0;
}
pre.editor-colors .selection .region {
  background-color: #49483E;
}
pre.editor-colors .search-results .syntax--marker .region {
  background-color: transparent;
  border: 1px solid #888;
}
pre.editor-colors .search-results .syntax--marker.current-result .region {
  border: 1px solid white;
}
pre.editor-colors .syntax--gfm .syntax--markup.syntax--heading {
  color: #A6E22E;
  font-weight: bold;
}
pre.editor-colors .syntax--gfm .syntax--markup.syntax--underline {
  color: #E6DB74;
  text-decoration: underline;
}
pre.editor-colors .syntax--gfm .syntax--bold {
  font-weight: bold;
}
pre.editor-colors .syntax--gfm .syntax--italic {
  font-style: italic;
}
pre.editor-colors .syntax--gfm .syntax--raw {
  color: #66D9EF;
}
pre.editor-colors .syntax--gfm .syntax--variable.syntax--list {
  color: #F92672;
  font-weight: bold;
}
pre.editor-colors .syntax--gfm .syntax--link {
  color: #CCC;
}
pre.editor-colors .syntax--gfm .syntax--link .syntax--entity {
  color: #AE81FF;
}
.syntax--comment {
  color: #75715E;
}
.syntax--constant.syntax--character,
.syntax--constant.syntax--language,
.syntax--constant.syntax--numeric,
.syntax--constant.syntax--other {
  color: #AE81FF;
}
.syntax--entity.syntax--name.syntax--class {
  text-decoration: none;
  color: #A6E22E;
}
.syntax--entity.syntax--name.syntax--function {
  color: #A6E22E;
}
.syntax--entity.syntax--name.syntax--instance {
  color: #66D9EF;
}
.syntax--entity.syntax--name.syntax--tag {
  color: #F92672;
}
.syntax--entity.syntax--other.syntax--attribute-name {
  color: #A6E22E;
}
.syntax--entity.syntax--other.syntax--inherited-class {
  font-style: italic;
  text-decoration: none;
  color: #A6E22E;
}
.syntax--invalid {
  color: #F8F8F0;
  background-color: #F92672;
}
.syntax--invalid.syntax--deprecated {
  background-color: #AE81FF;
}
.syntax--keyword {
  color: #F92672 !important;
}
.syntax--meta.syntax--tag {
  color: #F8F8F2;
}
.syntax--storage {
  color: #F92672;
}
.syntax--storage.syntax--type {
  font-style: italic;
  color: #66D9EF;
}
.syntax--string {
  color: #E6DB74;
}
.syntax--support.syntax--constant,
.syntax--support.syntax--function {
  color: #66D9EF;
}
.syntax--support.syntax--class,
.syntax--support.syntax--type {
  font-style: italic;
  color: #66D9EF;
}
.syntax--variable.syntax--parameter {
  font-style: italic;
  color: #FD971F;
}
.syntax--variable.syntax--language.syntax--python,
.syntax--variable.syntax--language.syntax--js {
  color: #F92672;
}
.syntax--class.syntax--jade {
  color: #AE81FF;
}
.leading-whitespace,
.trailing-whitespace {
  display: inline-block;
}
.syntax--js .syntax--template .syntax--element .syntax--quasi.syntax--begin,
.syntax--js .syntax--template .syntax--element .syntax--quasi.syntax--end {
  color: #F92672;
}
.syntax--js .syntax--template .syntax--element .syntax--variable,
.syntax--js .syntax--template .syntax--element .syntax--brace,
.syntax--js .syntax--template .syntax--element .syntax--comma {
  color: #F8F8F2;
}
.syntax--json .syntax--dictionary:not(.syntax--value) > .syntax--quoted,
.syntax--json .syntax--dictionary:not(.syntax--value) > .syntax--string > .syntax--punctuation {
  color: #a6e22e;
}
</style>
  </head>
  <body class='markdown-preview' data-use-github-style><h1 id="1-">1. 绪论</h1>
<h2 id="1-1-">1.1 红外遥控的发展</h2>
<p>二十世纪, 刚步入八十年代, 电视产品在日本快速发展, 相应的红外遥控技术也在这里得到了广泛应用。为了实现遥控码的发射, 他们使用了一种集成发射芯片, 这种芯片的特点是: 单一控制（内部预置固定编码的遥控器只能控制单一型号的电器）。</p>
<p>随着时代不断地进步, 在目前的日常家居生活里面, 一般家庭都会配置各种各样的家用电器, 相应的也会有各种各样的遥控器, 当需要遥控某一家用电器时, 需要从多个遥控器中选出特定的一个。当家用电器越来越多, 对应的遥控器也越来越多, 从众多的遥控器中选出所需要的遥控器也会更加麻烦, 过多的遥控器会占据相当一部分的家居空间, 也不方便整理。</p>
<p>针对这种情况, 人们便产生了一种想法: 是否可以用一只遥控器遥控所有家用电器[5]？答案是肯定的, 多用遥控器就此产生了, 这种遥控器的特点是: 遥控器里面预置了不止一套编码, 而是多套编码, 可供用户在不同场合选择不同模式。</p>
<p>伴随着科技的日新月异, 红外遥控技术和单片机技术已经越来越成熟, 嵌入式技术的大力发展, 使大部分商家都在生产一种新的遥控器: 这种遥控器内置一个动态的编码库, 库内存放用户自主录入的编码, 使其具备一中心的功能——红外学习功能, 这种遥控器也有了新的名称: 学习型红外遥控器。</p>
<h2 id="1-2-">1.2 红外通信原理概述</h2>
<p>所谓红外通信, 就是通过对二进制数字的调节与调制, 来进行信号传输, 红外通信接口就是红外信道的调制解调器。利用红外技术, 实现两点间的近距离保密通信和信息转发, 称为红外通信。它一般由两部分组成, 即: 红外发射系统与红外接收系统。单片机本身并不具备红外通信接口, 我们可以利用红外发射电路与红外接收电路组成一个应用于单片机的红外通信接口。</p>
<p>红外通信的基本原理是通过红外发射管发射的将基带二进制信号调制为一系列的脉冲串信号载波信号。</p>
<p>在红外通信过程中调制和发送的数据共有三种常用的协议:</p>
<ul>
<li>NEC协议</li>
<li>夏普协议</li>
<li>索尼SIRC协议</li>
</ul>
<p>其中应用最广泛的是NEC协议。NEC标准规定: 红外通信的载波频率为38KHz, 占空比为1: 3；数据格式包括了引导码、用户码、数据码和数据码反码, 编码总占 32 位。数据反码是 数据码反相后的编码, 编码时可用于对数据的纠错。注意: 第二段的用户码也可以在遥控应用电路中被设置成第一段用户码的反码, 如下图所示:</p>
<p><img src="/Users/but0n/GitHub/IrDA/Hardware/paper01.png" alt=""></p>
<h2 id="1-3-">1.3 通用红外通信设备学码的实现</h2>
<p>通用红外通信设备按照学习方式的不同可以分为两类:</p>
<ul>
<li>固定码格式的通信设备</li>
<li>波形拷贝式的通信设备</li>
</ul>
<p>第一种通信设备需要收集保存不同种类的红外设备信号, 然后识别比较, 最后再记录。这种红外设备的优点是硬件要求相对简易, 控制器的CPU频率可以较低；缺点是因为红外编码格式太多, 实现红外设备的成功复制比较难。</p>
<p>第二种通信设备是把原来红外设备发出的信号进行完全的复制, 不管原来红外设备红外信号是什么格式, 然后存储到非易失性的存储器(如EEPROM)中, 发送时再把保存的波形数据取出, 还原成原始信号。其优点是可以对任何一种红外设备进行学习；缺点是对控制器CPU的频率要求较高, RAM要大。
为了对尽可能多的设备进行控制, 本设计完成的是第二种红外通信设备。</p>
<h1 id="2-">2. 红外学码系统电路设计</h1>
<p><img src="/Users/but0n/GitHub/IrDA/Hardware/sche_overview.png" alt=""></p>
<p>上图是该硬件系统的完整电路图, 该电路共分为 7 个部分:</p>
<ol>
<li>稳压电源电路</li>
<li>单片机启动配置电路</li>
<li>单片机外部时钟晶振电路</li>
<li>单片机上电复位电路</li>
<li>8 路学码部分电路</li>
<li>8 路发码部分电路</li>
<li>电路板接口电路</li>
</ol>
<h2 id="2-1-">2.1 稳压电源电路</h2>
<p>稳压电源电路是用来将外部供电电源的电压转换成单片机所需的 3.3V 稳定的电压。</p>
<p><img src="/Users/but0n/GitHub/IrDA/Hardware/part_01.png" alt=""></p>
<p>这里使用了型号为 XC6206P332MR 的稳压 LDO 芯片, LDO即 Low Dropout Regulator, 是一种低压差线性稳压器。并且在芯片的电源输入引脚和电源输出引脚分别接了两个滤波电容, 用来防止电源可能发生的波动, 提高数字电路工作的稳健性。</p>
<p><img src="/Users/but0n/GitHub/IrDA/Hardware/part_0101.png" alt="">
<img src="/Users/but0n/GitHub/IrDA/Hardware/part_0102.png" alt=""></p>
<p>上图是该 LDO 芯片型号为 P302MR 的典型输入输出电压曲线, 横轴为输入电压, 纵轴为输出电压, 通过上图可以清楚的看出, 我们所使用的 P332MR 当输入电压在 3.4V ~ 6V 的范围内, 都可以输出稳定的 3.3V 电压。</p>
<p>(这张图表是XC6206P302的数据, 官方的数据手册中只有该型号的图表作为一个典型示例, 没有我们所使用的 P332MR, 所以图表中的输出电压不是3.3V)</p>
<h2 id="2-2-">2.2 单片机启动配置电路</h2>
<p>在STM32F10xxx里, 可以通过BOOT[1: 0]引脚选择三种不同启动模式:</p>
<p><img src="/Users/but0n/GitHub/IrDA/Hardware/part_0201.png" alt=""></p>
<ul>
<li><p>从主闪存存储器启动:  主闪存存储器被映射到启动空间 (0x0000 0000), 但仍然能够在它原
有的地址 (0x0800 0000) 访问它, 即闪存存储器的内容可以在两个地址区域访问, 0x0000
0000 或 0x0800 0000。</p>
<blockquote>
<p><strong>以这种模式启动会运行用户烧写的程序</strong></p>
</blockquote>
</li>
<li><p>从系统存储器启动: 系统存储器被映射到启动空间 (0x0000 0000), 但仍然能够在它原有的
地址(互联型产品原有地址为 0x1FFF B000, 其它产品原有地址为0x1FFF F000)访问它。</p>
<blockquote>
<p><strong>以这种模式启动会运行单片机出厂自带的 ISP 程序(In System Program 在系统编程), 这时我们可以通过串口连接单片机来上传程序。</strong></p>
</blockquote>
</li>
</ul>
<p>在系统复位后, SYSCLK 的第4个上升沿, BOOT 引脚的值将被锁存。用户可以通过设置 BOOT1
 和 BOOT0 引脚的状态, 来选择在复位后的启动模式。</p>
<p> <img src="/Users/but0n/GitHub/IrDA/Hardware/part_02.png" alt=""></p>
<p>在这次设计中, 我们将 BOOT1 通过一个 10K 的限流电阻直接接地, 通过 BOOT0 来控制单片机的启动模式。在实际使用的过程中, 单片机默认会以第一种模式启动 (BOOT0 悬空时为低电平), 也就是运行用户的程序, 如果我们要烧写程序, 只需要在单片机供电时确保 BOOT0 为高电平, 如下图, 将电阻 R3 右侧短接上方电容 C7 左侧即可。</p>
<p><img src="/Users/but0n/GitHub/IrDA/Hardware/part_0202.png" alt=""></p>
<h2 id="2-3-">2.3 单片机外部时钟晶振电路</h2>
<p><img src="/Users/but0n/GitHub/IrDA/Hardware/part_03.png" alt=""></p>
<p>4~16Mz外部振荡器可为系统提供更为精确的主时钟, 在这里单片机的高速外部时钟信号 (HSE) 是由以下一个8Mhz晶振产生的。
晶振两个引脚分别连接单片机的外部时钟引脚, 并且连接了两个 20pF 的负载电容, 作用是对晶体和振荡电路的补偿和匹配, 使电路易于起振并处于合理的激励态下, 同时对振荡频率也有一定的微调作用; 同时晶振也并联了一个 1M 欧的电阻 R2, 起到分流作用, 使晶振的工作电流在一个合理的范围内。</p>
<h2 id="2-4-">2.4 单片机上电复位电路</h2>
<p>STM32 支持三种复位形式, 分别为系统复位、上电复位和备份区域复位, 这里的电路图属于上电复位。</p>
<p><img src="/Users/but0n/GitHub/IrDA/Hardware/part_0401.png" alt=""></p>
<p>芯片内部的复位信号源是单片机的 NRST 引脚, 脉冲发生器保证每一个(外部或内部)复位源都能有
至少20μs的脉冲延时; 当 NRST 引脚被拉低产生外部复位时, 它将产生复位脉冲, 然后单片机将会复位除了备份区域外的所有寄存器, 也就是清除上次运行后单片机配置可能发生的改变, 目的是让系统回到一个固定的初始状态, 这时所有寄存器的值都是已知的, 所以在这之后对单片机的每一次操作的结果都是可以判断的。</p>
<p><img src="/Users/but0n/GitHub/IrDA/Hardware/part_04.png" alt=""></p>
<p>上图是单片机的上电复位电路, RESET 连接在单片机的 NRST 引脚, 在电路板开始供电时电容 C9 两侧是短路的, 也就是说这时 RESET 是直接接地的, 为低电平, 随着时间的推移, 电容将会被上拉的限流电阻 R8 充电, 随后 RESET 到 GND 之间就会形成断路, 这时 RESET 会变为高电平, 在整个过程也就中产生了低电平的复位信号。</p>
<h2 id="2-5-8-">2.5 8路学码部分电路</h2>
<p><img src="/Users/but0n/GitHub/IrDA/Hardware/part_05.png" alt=""></p>
<p>上图为 8 路的学码电路, 每一路都连接了一个 VS838 红外接收管:</p>
<p><img src="/Users/but0n/GitHub/IrDA/Hardware/part_0501.png" alt=""></p>
<p>VS838 的电源管脚 VCC 通过一个限流电阻接电源。</p>
<p>VS838 的 OUT 管脚是信号输出管脚, 当 VS838 接受到红外信号时 OUT 管脚会由高电平变为低电平, 直到红外信号消失。(未收到红外信号时 OUT 脚一直为高电平)</p>
<p><img src="/Users/but0n/GitHub/IrDA/Hardware/part_0502.png" alt=""> <img src="/Users/but0n/GitHub/IrDA/Hardware/part_0503.png" alt=""></p>
<p>红外信号输出管脚是单片机获取红外信号的唯一来源, 所以该管脚连接在单片机的 GPIO 上, 当收到红外信号时该管脚产生的电平下降沿会被单片机的 GPIO 捕获并产生外部中断, 在中断函数中我们会记录该波形也就是红外信号的波形长度, 从而进行学码。</p>
<h2 id="2-6-8-">2.6 8路发码部分电路</h2>
<p><img src="/Users/but0n/GitHub/IrDA/Hardware/part_06.png" alt=""></p>
<p>上图为 8 路的发码电路, NEC标准规定:  红外通信的载波频率为38KHz, 占空比为1: 3,</p>
<p>这里我们使用单片机定时器的 PWM 输出功能产生所需的 38KHz 1: 3 波形, 通过对 PWM 输出的打开和关闭来实现载波。PWM 信号管脚通过一个限流电阻连接一个 NPN 三极管的, 通过控制三极管来打开和关闭红外 LED 进行红外信号的发送。</p>
<p><img src="/Users/but0n/GitHub/IrDA/Hardware/part_0601.png" alt=""> <img src="/Users/but0n/GitHub/IrDA/Hardware/part_0602.png" alt=""></p>
<p>PWM 信号分别由单片机 TIM3 的四个通道和 TIM4 的四个通道产生。</p>
<h2 id="2-7-">2.7 电路板接口电路</h2>
<p><img src="/Users/but0n/GitHub/IrDA/Hardware/part_07.png" alt=""></p>
<p>该电路板的接口共有 4 个针脚:</p>
<ul>
<li>外部电源供电正极</li>
<li>外部电源供电负极</li>
<li>串口信号线 TX</li>
<li>串口信号线 RX</li>
</ul>
<p> 串口以其通信电路简单、可靠性高和传输距离远等优点，广泛应用在计算机与外设之间的通信电路中。</p>
<p>在本次设计中的串口有两个作用:</p>
<ul>
<li>串口控制:  电脑通过串口与电路板连接, 发送指令以控制单片机进行学码和发码操作</li>
<li>ISP:  电脑通过串口连接单片机来烧写程序。</li>
</ul>
<h1 id="3-8-">3. 串口控制的8路学码系统的软件原理</h1>
<h2 id="3-1-">3.1 主函数</h2>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>int</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>main</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>&nbsp;</span><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;配置中断优先级分组</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>NVIC_SetPriorityGrouping</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0x07</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span>&nbsp;NVIC_GROUPING</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_init</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>72</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>115200</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;初始化串口,&nbsp;波特率为115200</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>irda_init</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;irda初始化</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>while</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;uart_sendStr(&quot;Alive~&quot;);</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;UART_CR();</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;delay_ms(1000);</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>return</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div></pre>
<p>在系统供电之后单片机会进行下面这些操作:</p>
<ul>
<li>配置中断优先级分组</li>
<li>串口功能初始化</li>
<li>8路红外发码收码系统的初始化</li>
<li>死循环, 等待用户的进一步操作</li>
</ul>
<h2 id="3-2-">3.2 配置中断优先级分组</h2>
<p>该系统的主要功能如串口控制、红外信号的捕获都依赖于单片机中的中断功能, 所以在程序启动后我们首先要做的就是单片机中断相关的配置。</p>
<p>STM32单片机使用的 Cortex-M3 内核中搭载了一个中断响应系统, 支持为数众多的系统异常和外部中断。当系统存在多个中断时, 优先级对于中断来说就很关键了, 它会决定一个中断是否能被掩蔽, 以及在未掩蔽的
情况下何时可以响应。优先级的数值越小, 则优先级越高。CM3 支持中断嵌套, 使得高优先级中断
会抢占 (preempt) 低优先级中断。有 3 个系统异常: 复位, NMI 以及硬 fault, 它们有固定的优先
级, 并且它们的优先级号是负数, 从而高于所有其它异常。所有其它异常的优先级则都是可编程的。</p>
<p>为了使抢占机能变得更可控, CM3 还把 256 级优先级按位分成高低两段, 分别称
为抢占优先级和子优先级。</p>
<p>并且在 NVIC 中有一个寄存器是 “应用程序中断及复位控制寄存器” (AIRCR), 它里面有一个位段名为 “优先级组”。该位段的值对每一个优先级可配置的异常都有影响 —— 把其优先级分为 2 个
位段: MSB 所在的位段（左边的）对应抢占优先级, 而 LSB 所在的位段（右边的）对应子优先级。</p>
<p><img src="/Users/but0n/GitHub/IrDA/hardware/paper0301.png" alt=""></p>
<p><img src="/Users/but0n/GitHub/IrDA/hardware/paper03010.png" alt=""></p>
<p>下图是应用程序中断及复位控制寄存器 (AIRCR) 地址:  0xE000_ED0C 的详细说明</p>
<p><img src="/Users/but0n/GitHub/IrDA/hardware/paper0302.png" alt=""></p>
<p>我们所使用的 STM32 单片机的 PRIGROUP 只是用了4bit来表示:</p>
<p><img src="/Users/but0n/GitHub/IrDA/hardware/paper0304.png" alt=""></p>
<p><img src="/Users/but0n/GitHub/IrDA/hardware/paper0303.png" alt=""></p>
<p>通过上图我们可以得到一个规律, 即 PRIGROUP 的值等于 0x07 - 优先级组别。</p>
<p>在主函数中我们会通过下面这行语句将中断优先级分组设置为3, 在寄存器中:  xxx.y (x 指抢占式优先级, y 指响应式优先级):</p>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--preprocessor syntax--macro syntax--c"><span class="syntax--keyword syntax--control syntax--directive syntax--define syntax--c"><span class="syntax--punctuation syntax--definition syntax--directive syntax--c"><span>#</span></span><span>define</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--preprocessor syntax--c"><span>NVIC_GROUPING</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>3</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>NVIC_SetPriorityGrouping</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0x07</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span>&nbsp;NVIC_GROUPING</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div></pre>
<p>其中调用了 NVIC_SetPriorityGrouping 函数, 该函数用来设置 AIRCR 寄存器的 PPRIGROUP 位, 该函数的定义位于 STM32 官方的头文件 core_cm3.h 中:</p>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--block syntax--c"><span class="syntax--punctuation syntax--definition syntax--comment syntax--begin syntax--c"><span>/*</span></span><span>&nbsp;\brief&nbsp;&nbsp;Set&nbsp;Priority&nbsp;Grouping</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--block syntax--c"><span>&nbsp;&nbsp;The&nbsp;function&nbsp;sets&nbsp;the&nbsp;priority&nbsp;grouping&nbsp;field&nbsp;using&nbsp;the&nbsp;required&nbsp;unlock&nbsp;sequence.</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--block syntax--c"><span>&nbsp;&nbsp;The&nbsp;parameter&nbsp;PriorityGroup&nbsp;is&nbsp;assigned&nbsp;to&nbsp;the&nbsp;field&nbsp;SCB-&gt;AIRCR&nbsp;[10:&nbsp;8]&nbsp;PRIGROUP&nbsp;field.</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--block syntax--c"><span>&nbsp;&nbsp;Only&nbsp;values&nbsp;from&nbsp;0..7&nbsp;are&nbsp;used.</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--block syntax--c"><span>&nbsp;&nbsp;In&nbsp;case&nbsp;of&nbsp;a&nbsp;conflict&nbsp;between&nbsp;priority&nbsp;grouping&nbsp;and&nbsp;available</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--block syntax--c"><span>&nbsp;&nbsp;priority&nbsp;bits&nbsp;(__NVIC_PRIO_BITS),&nbsp;the&nbsp;smallest&nbsp;possible&nbsp;priority&nbsp;group&nbsp;is&nbsp;set.</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;\param&nbsp;[in]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PriorityGroup&nbsp;&nbsp;Priority&nbsp;grouping&nbsp;field.</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--block syntax--c"><span>&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--end syntax--c"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>__STATIC_INLINE&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>NVIC_SetPriorityGrouping</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--support syntax--type syntax--stdint syntax--c"><span>uint32_t</span></span><span>&nbsp;PriorityGroup</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--support syntax--type syntax--stdint syntax--c"><span>uint32_t</span></span><span>&nbsp;reg_value;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--support syntax--type syntax--stdint syntax--c"><span>uint32_t</span></span><span>&nbsp;PriorityGroupTmp&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>PriorityGroup&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--support syntax--type syntax--stdint syntax--c"><span>uint32_t</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0x07</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;only&nbsp;values&nbsp;0..7&nbsp;are&nbsp;used</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;reg_value&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;&nbsp;SCB</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>AIRCR</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;read&nbsp;old&nbsp;register&nbsp;configuration</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;reg_value&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>&amp;=</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>~</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>SCB_AIRCR_VECTKEY_Msk&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;SCB_AIRCR_PRIGROUP_Msk</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;clear&nbsp;bits&nbsp;to&nbsp;change</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;reg_value&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>reg_value&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span><span>(</span></span><span class="syntax--support syntax--type syntax--stdint syntax--c"><span>uint32_t</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0x5FA</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span>&nbsp;SCB_AIRCR_VECTKEY_Pos</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>PriorityGroupTmp&nbsp;</span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>8</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span><span>)</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;Insert&nbsp;write&nbsp;key&nbsp;and&nbsp;priorty&nbsp;group</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;SCB</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>AIRCR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;&nbsp;reg_value;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div></pre>
<h2 id="3-3-">3.3 串口功能初始化</h2>
<p>STM32 中的通用同步异步收发器(USART)提供了一种灵活的方法与使用工业标准NRZ异步串行数据格式的
外部设备之间进行全双工数据交换。USART利用分数波特率发生器提供宽范围的波特率选择。
它支持同步单向通信和半双工单线通信，也支持LIN(局部互连网)，智能卡协议和IrDA(红外数据
组织)SIR ENDEC规范，以及调制解调器(CTS/RTS)操作。它还允许多处理器通信。
使用多缓冲器配置的DMA方式，可以实现高速数据通信。</p>
<p>在配置好中断优先级分组后, 会进行单片机 USART1 串口的初始化, 配置其波特率为 115200, 并打开串口中断:</p>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_init</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>72</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>115200</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;初始化串口,&nbsp;波特率为115200</span></span></span></div></pre>
<p>下面是该函数的定义:</p>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_init</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--storage syntax--type syntax--c"><span>unsigned</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>int</span></span><span>&nbsp;pclk2,&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>unsigned</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>int</span></span><span>&nbsp;bound</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>&nbsp;</span><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>float</span></span><span>&nbsp;temp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>unsigned</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>short</span></span><span>&nbsp;mantissa;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>unsigned</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>short</span></span><span>&nbsp;fraction;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;temp&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--storage syntax--type syntax--c"><span>float</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>pclk2</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>1000000</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>/</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>bound</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>16</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;mantissa&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;temp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;fraction&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>temp&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span>&nbsp;mantissa</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>16</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;mantissa&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>&lt;&lt;=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>4</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;mantissa&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--c"><span>+=</span></span><span>&nbsp;fraction;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;RCC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>APB2ENR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;RCC_APB2ENR_IOPAEN;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;打开&nbsp;GPIOA&nbsp;时钟</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;RCC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>APB2ENR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;RCC_APB2ENR_USART1EN;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;打开&nbsp;USART1&nbsp;时钟</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;GPIOA</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CRH</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>&amp;=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0xFFFFF00F</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;USART&nbsp;GPIO&nbsp;引脚配置</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;GPIOA</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CRH</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0x000008B0</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;RCC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>APB2RSTR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;RCC_APB2RSTR_USART1RST;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;RCC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>APB2RSTR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>&amp;=</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>~</span></span><span>RCC_APB2RSTR_USART1RST;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;USART1</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>BRR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;mantissa;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;USART1</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CR1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0x200C</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>设置&nbsp;UE,&nbsp;TE&nbsp;and&nbsp;RE</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;USART1</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CR1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>8</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>PE&nbsp;中断使能</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;USART1</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CR1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>5</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>RX&nbsp;非空中断使能</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;USART1</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>SR</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;读取&nbsp;SR&nbsp;寄存器以将&nbsp;TXE&nbsp;和&nbsp;TE&nbsp;位清零,(复位值:&nbsp;&nbsp;0x00C0)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;SCB-&gt;AIRCR&nbsp;&amp;=&nbsp;0x05FAF8FF;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;AIRCE&nbsp;Key:&nbsp;&nbsp;0x05FA</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;SCB-&gt;AIRCR&nbsp;|=&nbsp;0x05FA0400;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Set&nbsp;up&nbsp;group&nbsp;value</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>NVIC_EnableIRQ</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>USART1_IRQn</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;使能串口中断</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>NVIC_SetPriority</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>USART1_IRQn,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0b1001</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>设置其优先级</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div></pre>
<p>该函数会进行下面这些操作:</p>
<ul>
<li>打开 USART1 和 USART1 所使用的 GPIO 的时钟, 由于 STM32 的低功耗设计, 只有在打开时钟后才能操作对应的外设。</li>
<li><p>配置 GPIO 引脚:</p>
<p>  <img src="/Users/but0n/GitHub/IrDA/hardware/paper030301.png" alt=""></p>
<p>  在本次设计中我们使用的串口是全双工模式的, 所以根据上图要求, TX 应该配置为推挽复用输出, RX 应该配置为浮空输入或上拉输入。其中 GPIO 引脚的配置需要操作 CRL 或 CRH 寄存器, 下图是该寄存器的说明:</p>
<p>  <img src="/Users/but0n/GitHub/IrDA/hardware/paper030302.png" alt=""></p>
<p>  通过上表我们可以看到, 推挽复用输出的值为 0b1000 (0x8), 上拉输入的值为 0b1011 (0xB), 所以就有了下面这两行配置代码:</p>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span>&nbsp;&nbsp;GPIOA</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>CRH&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>&amp;=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0xFFFFF00F</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;USART&nbsp;GPIO&nbsp;引脚配置</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>&nbsp;&nbsp;GPIOA</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>CRH&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0x000008B0</span></span><span>;</span></span></div></pre>
</li>
<li>复位并配置串口1相关寄存器</li>
<li>使能单片机的串口中断, 当单片机收到用户从电脑发送的字符后,  会触发串口中断并执行下面的中断处理函数 USART1_IRQHandler :</li>
</ul>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>USART1_IRQHandler</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>&nbsp;</span><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>if</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>USART1</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>SR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span>&nbsp;USART_SR_RXNE</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--modifier syntax--c"><span>const</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>char</span></span><span>&nbsp;cmd&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;USART1</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>DR</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;读取串口接收寄存器来清除&nbsp;RXNE&nbsp;标志</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>switch</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>cmd</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>case</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0x0D</span></span><span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>回车键</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>case</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0x0A</span></span><span>:</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_sendStr</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--string syntax--quoted syntax--double syntax--c"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--c"><span>&quot;</span></span><span class="syntax--constant syntax--character syntax--escape syntax--c"><span>\n</span><span>\r</span></span><span>当前命令:&nbsp;</span><span class="syntax--constant syntax--character syntax--escape syntax--c"><span>\t</span></span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--c"><span>&quot;</span></span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_sendStr</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--global syntax--mac-classic syntax--c"><span>gCmdCache</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>UART_CR</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_decode</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--global syntax--mac-classic syntax--c"><span>gCmdCache</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>clrCache</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>break</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>case</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0x08</span></span><span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>退格键</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>case</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0x7F</span></span><span>:</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>if</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>top</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;=</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;防止指针跨域操作,&nbsp;否则多次按退格键会出现bug</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--c"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--c"><span>&#39;</span></span><span class="syntax--constant syntax--character syntax--escape syntax--c"><span>\0</span></span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--c"><span>&#39;</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_sendData</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0x7F</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_sendData</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0x08</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>break</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>case</span></span><span>&nbsp;TOKEN_START:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>$&nbsp;-&nbsp;命令起始标志</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>clrCache</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>default</span></span><span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>其它按键</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>if</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>STACK_OVERFLOW</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>如果指令缓存将要溢出,&nbsp;则不会入栈当前字符</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>break</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>push</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>cmd</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>保存当前字符</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_sendData</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>cmd</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>在终端回显,&nbsp;反馈用户输入的字符</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>break</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div></pre>
<p>我们将用户的输入分为四种:</p>
<ul>
<li>串口命令的起始标志:  $</li>
<li>普通字符, 比如字母和数字</li>
<li>回车键</li>
<li>删除键</li>
</ul>
<p>在上面的源码中可以清楚的看到, 当单片机收到第一种输入也就是 &#39;$&#39; 时, 单片机会清空用于记录串口控制指令的数组。</p>
<p>当单片机收到第二种输入时, 单片机会记录并保存用户当前输入的字符到用于记录串口指令的数组中, 并把当前字符通过串口发送给电脑, 也就是在终端中反馈给用户。</p>
<p>当单片机收到第三种输入即回车键时, 单片机会通过调用 uart_decode 函数来解析当前指令并执行相应的操作。</p>
<p>当单片机收到第四种输入即删除键时, 单片机会在串口控制指令数组中删除最后的一个字符, 并且通过串口输出删除键的键值, 以删除电脑终端上的字符, 这样就实现了删除字符的功能。</p>
<h3 id="3-3-1-">3.3.1 串口控制指令的规则定义</h3>
<p>我们在头文件 uart.h 中实现了串口指令的规则的宏定义:</p>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--preprocessor syntax--macro syntax--c"><span class="syntax--keyword syntax--control syntax--directive syntax--define syntax--c"><span class="syntax--punctuation syntax--definition syntax--directive syntax--c"><span>#</span></span><span>define</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--preprocessor syntax--c"><span>TOKEN_START</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--c"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--c"><span>&#39;</span></span><span>$</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--c"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--preprocessor syntax--macro syntax--c"><span class="syntax--keyword syntax--control syntax--directive syntax--define syntax--c"><span class="syntax--punctuation syntax--definition syntax--directive syntax--c"><span>#</span></span><span>define</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--preprocessor syntax--c"><span>TOKEN_SEND</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--c"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--c"><span>&#39;</span></span><span>S</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--c"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--preprocessor syntax--macro syntax--c"><span class="syntax--keyword syntax--control syntax--directive syntax--define syntax--c"><span class="syntax--punctuation syntax--definition syntax--directive syntax--c"><span>#</span></span><span>define</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--preprocessor syntax--c"><span>TOKEN_LEARN</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--c"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--c"><span>&#39;</span></span><span>L</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--c"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--preprocessor syntax--macro syntax--c"><span class="syntax--keyword syntax--control syntax--directive syntax--define syntax--c"><span class="syntax--punctuation syntax--definition syntax--directive syntax--c"><span>#</span></span><span>define</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--preprocessor syntax--c"><span>TOKEN_OFFSET</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0x01</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--preprocessor syntax--macro syntax--c"><span class="syntax--keyword syntax--control syntax--directive syntax--define syntax--c"><span class="syntax--punctuation syntax--definition syntax--directive syntax--c"><span>#</span></span><span>define</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--preprocessor syntax--c"><span>CMD_NUM_MAX</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--c"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--c"><span>&#39;</span></span><span>8</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--c"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--preprocessor syntax--macro syntax--c"><span class="syntax--keyword syntax--control syntax--directive syntax--define syntax--c"><span class="syntax--punctuation syntax--definition syntax--directive syntax--c"><span>#</span></span><span>define</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--preprocessor syntax--c"><span>CMD_NUM_MIN</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--c"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--c"><span>&#39;</span></span><span>1</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--c"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--preprocessor syntax--macro syntax--c"><span class="syntax--keyword syntax--control syntax--directive syntax--define syntax--c"><span class="syntax--punctuation syntax--definition syntax--directive syntax--c"><span>#</span></span><span>define</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--preprocessor syntax--c"><span>ISLEGAL_NUM</span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--begin syntax--c"><span>(</span></span><span class="syntax--variable syntax--parameter syntax--preprocessor syntax--c"><span>k</span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--end syntax--c"><span>)</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span><span>(</span><span>(</span></span><span>k</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;=</span></span><span>&nbsp;CMD_NUM_MIN</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--logical syntax--c"><span>&amp;&amp;</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span><span>(</span></span><span>k</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&lt;=</span></span><span>&nbsp;CMD_NUM_MAX</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span><span>)</span></span></span></span></div></pre>
<p>在规则中定义了下面三种特殊标志:</p>
<ul>
<li><p>$ 字符作为串口指令的起始标志, 当用户输入 $ 时意味着一条指令的开始, 在 $ 之前输入的所有字符都将被删除, 在 $ 之后输入的所有字符都将作为串口指令被记录;</p>
</li>
<li><p><strong>S</strong> (Send)字符作为红外发码指令的标志, 该标志应当紧随着命令起始标志 $, 例如:</p>
<ul>
<li>$S1 - 1号红外外设执行发码操作</li>
<li>$S123 - 1号、2号、3号外设执行发码操作</li>
<li>$S85 - 8号、5号外设执行发码操作</li>
</ul>
</li>
</ul>
<ul>
<li><strong>L</strong> (Learn)字符作为红外收码状态切换 (Toggle) 指令, 状态切换指的是如果被操作外设的收码状态是关闭的则执行该指令后会被打开, 如果是打开的则会被关闭, 同样该标志也要紧随着命令起始标志 $, 例如:<ul>
<li>$L2 - 2号红外外设收码状态切换</li>
<li>$L345 - 3号、4号、5号红外外设收码状态切换</li>
</ul>
</li>
</ul>
<p>在规则中定义了操作标志 S 和 L 在指令中的偏移值, 当前的规则是操作标志的位置必须在指令的第二个字符, 也就是紧随起始标志之后。</p>
<p>在规则中定义了指令中可能出现的数字的最大值以及最小值, 以限制数字的合法范围, 防止非法指令造成的越界操作, 提高该系统的稳健性。该范围取决于本系统的红外外设数量, 在这里我们共有8路外设, 所以其合法范围是 1 到 8。</p>
<h3 id="3-3-2-">3.3.2 串口控制指令的解析</h3>
<p>当用户在终端中键入回车键意味着一条指令的结束, 这时该指令会通过 uart_decode 函数来进行解析, 该函数的定义在 uart.c 文件中, 下面是该函数的源码:</p>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_decode</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--storage syntax--type syntax--c"><span>char</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>token</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>&nbsp;</span><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>if</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>token&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>==</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>return</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>如果发生越界则结束&nbsp;decode</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>if</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>ISLEGAL_NUM</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>token</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>如果当前操作符为效数字</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_sendStr</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--string syntax--quoted syntax--double syntax--c"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--c"><span>&quot;</span></span><span>&nbsp;-&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--c"><span>&quot;</span></span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_sendData</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>token</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>在终端显示当前处理的学码电路通道号</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;如果这条指令是学码命令</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>if</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--global syntax--mac-classic syntax--c"><span>gCmdCache</span></span><span>[TOKEN_OFFSET]&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>==</span></span><span>&nbsp;TOKEN_LEARN</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;(Toggle&nbsp;between&nbsp;enable&nbsp;and&nbsp;disable)&nbsp;如果该路学码中断是关闭的则使能,&nbsp;反之则关闭</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>g_IrDA_Device[</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>token&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--c"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--c"><span>&#39;</span></span><span>1</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--c"><span>&#39;</span></span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>^=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_sendStr</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--string syntax--quoted syntax--double syntax--c"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--c"><span>&quot;</span></span><span>号:&nbsp;学码</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--c"><span>&quot;</span></span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_sendStr</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>g_IrDA_Device[</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>token&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--c"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--c"><span>&#39;</span></span><span>1</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--c"><span>&#39;</span></span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span class="syntax--keyword syntax--operator syntax--ternary syntax--c"><span>?</span></span><span class="syntax--string syntax--quoted syntax--double syntax--c"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--c"><span>&quot;</span></span><span>开启</span><span class="syntax--constant syntax--character syntax--escape syntax--c"><span>\n</span><span>\r</span></span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--c"><span>&quot;</span></span></span><span class="syntax--keyword syntax--operator syntax--ternary syntax--c"><span>:</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--double syntax--c"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--c"><span>&quot;</span></span><span>关闭</span><span class="syntax--constant syntax--character syntax--escape syntax--c"><span>\n</span><span>\r</span></span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--c"><span>&quot;</span></span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>else</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>if</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--global syntax--mac-classic syntax--c"><span>gCmdCache</span></span><span>[TOKEN_OFFSET]&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>==</span></span><span>&nbsp;TOKEN_SEND</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;如果这条指令是发码命令</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_sendStr</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--string syntax--quoted syntax--double syntax--c"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--c"><span>&quot;</span></span><span>号:&nbsp;发码开启</span><span class="syntax--constant syntax--character syntax--escape syntax--c"><span>\n</span><span>\r</span></span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--c"><span>&quot;</span></span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;在发码的过程中为了防止自发自收,&nbsp;得确保所有的接收中断都是关闭的,&nbsp;否则中断会干扰发送</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>2</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>3</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>4</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>5</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>7</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>irda_encode</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span>g_IrDA_Device[</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>token&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--c"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--c"><span>&#39;</span></span><span>1</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--c"><span>&#39;</span></span></span><span>]</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>发码</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_decode</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--increment syntax--c"><span>++</span></span><span>token</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div></pre>
<p>从上面的代码中我们不难看出, 该函数一次只判断一次字符, 当该字符为合法数字时根据当前指令中的操作标志对该数字代表的外设执行相应的操作, 然后再次调用该函数, 处理下一个字符, 以实现对当前串口指令中每一个字符的遍历。</p>
<h2 id="3-4-">3.4 八路红外发码收码系统的初始化</h2>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>irda_init</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>&nbsp;</span><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>irda_PWM_Init</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;发送功能初始化</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>irda_EXTI_Init</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;接收功能初始化</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>实例化红外外设对象&nbsp;-&nbsp;第&nbsp;1&nbsp;路</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IMR</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrPWM</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCER</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>signal</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>GPIOC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IDR</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>实例化红外外设对象&nbsp;-&nbsp;第&nbsp;2&nbsp;路</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IMR</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrPWM</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCER</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>4</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>signal</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>GPIOC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IDR</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>实例化红外外设对象&nbsp;-&nbsp;第&nbsp;3&nbsp;路</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>2</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IMR</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>2</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>2</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrPWM</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCER</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>8</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>2</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>signal</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>GPIOC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IDR</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>2</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>实例化红外外设对象&nbsp;-&nbsp;第&nbsp;4&nbsp;路</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>3</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IMR</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>3</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>3</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrPWM</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCER</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>12</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>3</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>signal</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>GPIOC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IDR</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>3</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>实例化红外外设对象&nbsp;-&nbsp;第&nbsp;5&nbsp;路</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>4</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IMR</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>4</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrPWM</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCER</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>4</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>signal</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>GPIOC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IDR</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>实例化红外外设对象&nbsp;-&nbsp;第&nbsp;6&nbsp;路</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>5</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IMR</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>7</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>5</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrPWM</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCER</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>4</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>5</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>signal</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>GPIOC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IDR</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>7</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>实例化红外外设对象&nbsp;-&nbsp;第&nbsp;7&nbsp;路</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IMR</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>8</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrPWM</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCER</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>8</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>signal</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>GPIOC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IDR</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>8</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>实例化红外外设对象&nbsp;-&nbsp;第&nbsp;8&nbsp;路</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>7</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IMR</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>9</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>7</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrPWM</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCER</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>12</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>7</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>signal</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>GPIOC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IDR</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>9</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div></pre>
<p>上面是红外外设初始化函数, 该函数执行了下面几个操作:</p>
<ul>
<li>发码功能初始化, 也就是 PWM 初始化</li>
<li>收码功能初始化, 也就是外部中断初始化</li>
<li>分别实例化 8 路红外外设对象</li>
</ul>
<h3 id="3-4-1-">3.4.1 发码功能初始化</h3>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>红外学码电路发码部分初始化函数</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>irda_PWM_Init</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>&nbsp;</span><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;红外发射管分别依次连接在单片机的&nbsp;TIM3_CH1,&nbsp;TIM3_CH2,&nbsp;TIM3_CH3,&nbsp;TIM3_CH4,</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TIM4_CH1,&nbsp;TIM4_CH2,&nbsp;TIM4_CH3,&nbsp;TIM4_CH4</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;所以在这个函数中需要初始化&nbsp;TIM3&nbsp;和&nbsp;TIM4</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;RCC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>APB1ENR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;RCC_APB1ENR_TIM3EN&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;RCC_APB1ENR_TIM4EN;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>TIM3&nbsp;Enable</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;RCC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>APB2ENR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;RCC_APB2ENR_IOPAEN&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;RCC_APB2ENR_IOPBEN;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>IO&nbsp;Port&nbsp;A&nbsp;and&nbsp;B&nbsp;Enable</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;GPIOA&nbsp;GPIOB&nbsp;寄存器配置</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;GPIOA</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CRL</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>&amp;=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0x00FFFFFF</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;GPIOA</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CRL</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0xBB000000</span></span><span>;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>将&nbsp;6,&nbsp;7&nbsp;脚配置为复用推挽输出</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;GPIOA</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>ODR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>7</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>TIM3_CH2&nbsp;GPIO&nbsp;配置</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;GPIOA</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>ODR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>TIM3_CH1&nbsp;GPIO&nbsp;配置</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;GPIOB</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CRL</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>&amp;=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0x00FFFF00</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;GPIOB</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CRL</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0xBB0000BB</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>将&nbsp;0,&nbsp;1,&nbsp;6,&nbsp;7&nbsp;脚配置为复用推挽输出</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;GPIOB</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CRH</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>&amp;=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0xFFFFFF00</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;GPIOB</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CRH</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0x000000BB</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>将&nbsp;8,&nbsp;9&nbsp;脚配置为复用推挽输出</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;GPIOB</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>ODR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>7</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>8</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>9</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;TIM3&nbsp;寄存器配置</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>ARR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;IR_PWM_ARR&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>配置计数器最大值</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>PSC</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;IR_PWM_PSC&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>配置计数器分频</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCMR1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>4</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>CH1&nbsp;设置为&nbsp;OC1M[2:&nbsp;0]:&nbsp;&nbsp;PWM&nbsp;模式</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCMR1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;TIM_CCMR1_OC1PE;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>CH1&nbsp;设置为&nbsp;OC1PE:&nbsp;&nbsp;使能</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCMR1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>12</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>CH2&nbsp;设置为&nbsp;OC2M[2:&nbsp;0]:&nbsp;&nbsp;PWM&nbsp;模式</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCMR1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;TIM_CCMR1_OC2PE;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>CH2&nbsp;设置为&nbsp;OC2PE:&nbsp;&nbsp;使能</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCMR2</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>4</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>CH3&nbsp;设置为&nbsp;OC3M[2:&nbsp;0]:&nbsp;&nbsp;PWM&nbsp;模式</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCMR2</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;TIM_CCMR2_OC3PE;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>CH3</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCMR2</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>12</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>CH4</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCMR2</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;TIM_CCMR2_OC4PE;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>CH4</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCR1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCR2</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCR3</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCR4</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;IR_PWM_CCR_DEF;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>CH1&nbsp;~&nbsp;CH4&nbsp;计数器使能</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;TIM3-&gt;CCER&nbsp;|=&nbsp;TIM_CCER_CC1E&nbsp;|&nbsp;TIM_CCER_CC2E&nbsp;|&nbsp;TIM_CCER_CC3E&nbsp;|&nbsp;TIM_CCER_CC4E;</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM3</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CR1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;TIM_CR1_ARPE&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;TIM_CR1_CEN;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>配置APRE位并使能计数器</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;TIM4&nbsp;寄存器配置</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>ARR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;IR_PWM_ARR&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>配置计数器最大值</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>PSC</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;IR_PWM_PSC&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>配置计数器分频</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCMR1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>4</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>CH1&nbsp;设置为&nbsp;OC1M[2:&nbsp;0]:&nbsp;&nbsp;PWM&nbsp;模式</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCMR1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;TIM_CCMR1_OC1PE;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>CH1&nbsp;设置为&nbsp;OC1PE:&nbsp;&nbsp;使能</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCMR1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>12</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>CH2&nbsp;设置为&nbsp;OC2M[2:&nbsp;0]:&nbsp;&nbsp;PWM&nbsp;模式</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCMR1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;TIM_CCMR1_OC2PE;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>CH2&nbsp;设置为&nbsp;OC2PE:&nbsp;&nbsp;使能</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCMR2</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>4</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>CH3&nbsp;设置为&nbsp;OC3M[2:&nbsp;0]:&nbsp;&nbsp;PWM&nbsp;模式</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCMR2</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;TIM_CCMR2_OC3PE;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>CH3</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCMR2</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>12</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>CH4</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCMR2</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;TIM_CCMR2_OC4PE;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>CH4</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCR1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCR2</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCR3</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CCR4</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;IR_PWM_CCR_DEF;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>CH1&nbsp;~&nbsp;CH4&nbsp;计数器使能</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;TIM4-&gt;CCER&nbsp;|=&nbsp;TIM_CCER_CC1E&nbsp;|&nbsp;TIM_CCER_CC2E&nbsp;|&nbsp;TIM_CCER_CC3E&nbsp;|&nbsp;TIM_CCER_CC4E;</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;TIM4</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CR1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;TIM_CR1_ARPE&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;TIM_CR1_CEN;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>配置APRE位并使能计数器</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div></pre>
<p>红外发射管分别依次连接在单片机的 TIM3_CH1、TIM3_CH2、TIM3_CH3、TIM3_CH4、TIM4_CH1、TIM4_CH2、TIM4_CH3、TIM4_CH4, 所以在这个函数中初始化了 TIM3 和 TIM4 的 PWM 输出功能, 并且按照 NEC 协议标准将其 PWM 配置为 38KHz 1: 3占空比。</p>
<h3 id="3-4-2-">3.4.2 收码功能初始化</h3>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>红外学码电路收码部分初始化函数</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>irda_EXTI_Init</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>&nbsp;</span><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>使能外部中断</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>NVIC_EnableIRQ</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI0_IRQn</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>NVIC_EnableIRQ</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI1_IRQn</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>NVIC_EnableIRQ</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI2_IRQn</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>NVIC_EnableIRQ</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI3_IRQn</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>NVIC_EnableIRQ</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI9_5_IRQn</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>NVIC_SetPriority</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI0_IRQn,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0b0011</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>设置中断优先级</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>NVIC_SetPriority</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI1_IRQn,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0b0011</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>设置中断优先级</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>NVIC_SetPriority</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI2_IRQn,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0b0011</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>设置中断优先级</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>NVIC_SetPriority</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI3_IRQn,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0b0011</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>设置中断优先级</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>NVIC_SetPriority</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI9_5_IRQn,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0b0011</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>设置中断优先级</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;红外接收管的数据输出分别连接在单片机GPIO端口&nbsp;C&nbsp;的0,&nbsp;1,&nbsp;2,&nbsp;3,&nbsp;6,&nbsp;7,&nbsp;8,&nbsp;9&nbsp;引脚</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;RCC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>APB2ENR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;RCC_APB2ENR_AFIOEN;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>使能&nbsp;AFIO&nbsp;时钟,&nbsp;因为中断属于复用功能</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;RCC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>APB2ENR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;RCC_APB2ENR_IOPCEN;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>使能&nbsp;IO&nbsp;Port&nbsp;C&nbsp;时钟</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;76543210</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;GPIOC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CRL</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>&amp;=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0x00FF0000</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>清空&nbsp;0,&nbsp;1,&nbsp;2,&nbsp;3,&nbsp;6,&nbsp;7</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;GPIOC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CRL</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0x88008888</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>配置为输入模式</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;GPIOC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CRH</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>&amp;=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0xFFFFFF00</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>清空&nbsp;8,&nbsp;9</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;GPIOC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>CRH</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0x00000088</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>配置为输入模式</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;GPIOC</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>ODR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>2</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>3</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>7</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>8</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>9</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>上拉电阻</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;AFIO</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>EXTICR</span></span><span>[</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span>]&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0x2222</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>使能C端口&nbsp;0,&nbsp;1,&nbsp;2,&nbsp;3&nbsp;引脚的中断复用</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;AFIO</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>EXTICR</span></span><span>[</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>]&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0x2200</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>使能C端口&nbsp;6,&nbsp;7&nbsp;引脚的中断复用</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;AFIO</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>EXTICR</span></span><span>[</span><span class="syntax--constant syntax--numeric syntax--c"><span>2</span></span><span>]&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0x0022</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>使能C端口&nbsp;8,&nbsp;9&nbsp;引脚的中断复用</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>FTSR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>2</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>3</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>7</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>8</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>9</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>下降沿触发</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>RTSR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>2</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>3</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>7</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>8</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>|</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>9</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>上升沿触发</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div></pre>
<p>红外接收管的数据输出分别连接在单片机GPIO端口 C 的0, 1, 2, 3, 6, 7, 8, 9 引脚, 该函数配置了相应管脚的外部中断, 当收码状态被用户通过串口指令设置为打开后, 如果该路的红外接收管收到红外信号则会产生下降沿然后会被单片机捕获并执行相应的中断处理函数。</p>
<p>下面的源码是各路中断处理函数的定义:</p>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>各路的中断处理函数</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>EXTI0_IRQHandler</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>&nbsp;</span><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>IRQ_HANDLE_CORE</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>PR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>EXTI1_IRQHandler</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>&nbsp;</span><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>IRQ_HANDLE_CORE</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>PR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>EXTI2_IRQHandler</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>&nbsp;</span><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>IRQ_HANDLE_CORE</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>2</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>PR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>2</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>EXTI3_IRQHandler</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>&nbsp;</span><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>IRQ_HANDLE_CORE</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>3</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>PR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>3</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>EXTI9_5_IRQHandler</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>&nbsp;</span><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>unsigned</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>long</span></span><span>&nbsp;origin&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>PR</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>if</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>origin&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span>&nbsp;EXTI_PR_PR6</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>如果来源为&nbsp;6</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>IRQ_HANDLE_CORE</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>4</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>PR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>else</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>if</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>origin&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span>&nbsp;EXTI_PR_PR7</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>如果来源为&nbsp;7</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>IRQ_HANDLE_CORE</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>5</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>PR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>7</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>else</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>if</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>origin&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span>&nbsp;EXTI_PR_PR8</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>如果来源为&nbsp;8</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>IRQ_HANDLE_CORE</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>PR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>8</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>else</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>if</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>origin&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span>&nbsp;EXTI_PR_PR9</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>如果来源为&nbsp;9</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>IRQ_HANDLE_CORE</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>7</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXTI</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>PR</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>|=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--keyword syntax--operator syntax--bitwise syntax--shift syntax--c"><span>&lt;&lt;</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>9</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div></pre>
<p>可以看出当每一路都调用了一个名为 IRQ_HANDLE_CORE() 的宏, 也可以称作内联函数, 是在头文件 irda.h 中声明的:</p>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--preprocessor syntax--macro syntax--c"><span class="syntax--keyword syntax--control syntax--directive syntax--define syntax--c"><span class="syntax--punctuation syntax--definition syntax--directive syntax--c"><span>#</span></span><span>define</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--preprocessor syntax--c"><span>IRQ_HANDLE_CORE</span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--begin syntax--c"><span>(</span></span><span class="syntax--variable syntax--parameter syntax--preprocessor syntax--c"><span>i</span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--end syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>do</span></span><span>&nbsp;</span><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span><span class="syntax--constant syntax--character syntax--escape syntax--line-continuation syntax--c"><span>\</span></span><span>&nbsp;</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--preprocessor syntax--macro syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>g_IrDA_Device[</span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>i</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>]</span><span class="syntax--punctuation syntax--separator syntax--dot-access syntax--c"><span>.</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrInterrup</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span>;</span><span class="syntax--constant syntax--character syntax--escape syntax--line-continuation syntax--c"><span>\</span></span><span>&nbsp;</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--preprocessor syntax--macro syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>irda_decode</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span>g_IrDA_Device[</span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>i</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>]</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span><span class="syntax--constant syntax--character syntax--escape syntax--line-continuation syntax--c"><span>\</span></span><span>&nbsp;</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--preprocessor syntax--macro syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--character syntax--escape syntax--line-continuation syntax--c"><span>\</span></span><span>&nbsp;</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--preprocessor syntax--macro syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>IR_WAVE_FEEDBACK</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>i</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span><span class="syntax--constant syntax--character syntax--escape syntax--line-continuation syntax--c"><span>\</span></span><span>&nbsp;</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--preprocessor syntax--macro syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--character syntax--escape syntax--line-continuation syntax--c"><span>\</span></span><span>&nbsp;</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--preprocessor syntax--macro syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>UART_CR</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span><span class="syntax--constant syntax--character syntax--escape syntax--line-continuation syntax--c"><span>\</span></span><span>&nbsp;</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--preprocessor syntax--macro syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span><span>&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>while</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span></span></div></pre>
<p><em>i为被控制的外设号码</em></p>
<p>在上面的定义中, 该内联函数先关闭被操作外设的外部中断, 防止在学码过程中被打断, 然后执行 irda_decode 函数来执行学码操作, 最后执行 IR_WAVE_FEEDBACK 在终端将解析到的红外波形数据在终端中反馈给用户。</p>
<h3 id="3-4-3-">3.4.3 红外外设对象初始化</h3>
<p>本次设计中使用面对对象的思维方式, 通过C语言的结构体 (struct) 来实现红外外设对象的封装, 通过这种方法可以增加代码可读性, 提高执行效率。</p>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--preprocessor syntax--macro syntax--c"><span class="syntax--keyword syntax--control syntax--directive syntax--define syntax--c"><span class="syntax--punctuation syntax--definition syntax--directive syntax--c"><span>#</span></span><span>define</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--preprocessor syntax--c"><span>IR_DEVICES_NUM</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>8</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>共有8路学码发码外设</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--preprocessor syntax--macro syntax--c"><span class="syntax--keyword syntax--control syntax--directive syntax--define syntax--c"><span class="syntax--punctuation syntax--definition syntax--directive syntax--c"><span>#</span></span><span>define</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--preprocessor syntax--c"><span>WAVE_SEGMEENT_NUM</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>400</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>红外波形共有200次电平翻转</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>typedef</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>struct</span></span><span>&nbsp;</span><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>unsigned</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>short</span></span><span>&nbsp;token[WAVE_SEGMEENT_NUM];</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>保存红外波形的数组</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--modifier syntax--c"><span>volatile</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>unsigned</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>long</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>IrInterrup;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>指针指向中断使能寄存器的某一位&nbsp;(位带操作),&nbsp;用来打开和关闭当前中断</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--modifier syntax--c"><span>volatile</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>unsigned</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>long</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>IrPWM;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>指针指向&nbsp;PWM&nbsp;使能寄存器的某一位&nbsp;(位带操作),&nbsp;用来打开和关闭&nbsp;PWM</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--modifier syntax--c"><span>volatile</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>unsigned</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>long</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span class="syntax--support syntax--function syntax--C99 syntax--c"><span>signal</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>指针指向&nbsp;GPIO&nbsp;ODR&nbsp;的某一位,&nbsp;用来检测输入红外波形的高低</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span><span>&nbsp;ir_st,&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>ir_pst;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>ir_st&nbsp;g_IrDA_Device[IR_DEVICES_NUM];</span></span></div></pre>
<p><strong>这里定义了一个全局变量, 用来存储 8 红外外设对象</strong>, 并在红外发码收码系统初始化函数中对其赋值:</p>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>实例化红外外设对象&nbsp;-&nbsp;第&nbsp;1&nbsp;路</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span>].IrInterrup&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>IMR</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span>].IrPWM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>TIM3</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>CCER</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span>].signal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>GPIOC</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>IDR</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>实例化红外外设对象&nbsp;-&nbsp;第&nbsp;2&nbsp;路</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>].IrInterrup&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>IMR</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>].IrPWM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>TIM3</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>CCER</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>4</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>].signal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>GPIOC</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>IDR</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>实例化红外外设对象&nbsp;-&nbsp;第&nbsp;3&nbsp;路</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>2</span></span><span>].IrInterrup&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>IMR</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>2</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>2</span></span><span>].IrPWM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>TIM3</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>CCER</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>8</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>2</span></span><span>].signal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>GPIOC</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>IDR</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>2</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>实例化红外外设对象&nbsp;-&nbsp;第&nbsp;4&nbsp;路</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>3</span></span><span>].IrInterrup&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>IMR</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>3</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>3</span></span><span>].IrPWM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>TIM3</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>CCER</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>12</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>3</span></span><span>].signal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>GPIOC</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>IDR</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>3</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>实例化红外外设对象&nbsp;-&nbsp;第&nbsp;5&nbsp;路</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>4</span></span><span>].IrInterrup&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>IMR</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>4</span></span><span>].IrPWM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>TIM4</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>CCER</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>4</span></span><span>].signal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>GPIOC</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>IDR</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>实例化红外外设对象&nbsp;-&nbsp;第&nbsp;6&nbsp;路</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>5</span></span><span>].IrInterrup&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>IMR</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>7</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>5</span></span><span>].IrPWM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>TIM4</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>CCER</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>4</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>5</span></span><span>].signal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>GPIOC</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>IDR</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>7</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>实例化红外外设对象&nbsp;-&nbsp;第&nbsp;7&nbsp;路</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span>].IrInterrup&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>IMR</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>8</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span>].IrPWM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>TIM4</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>CCER</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>8</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>6</span></span><span>].signal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>GPIOC</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>IDR</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>8</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>实例化红外外设对象&nbsp;-&nbsp;第&nbsp;8&nbsp;路</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>7</span></span><span>].IrInterrup&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>EXTI</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>IMR</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>9</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>7</span></span><span>].IrPWM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>TIM4</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>CCER</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>12</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>g_IrDA_Device[</span><span class="syntax--constant syntax--numeric syntax--c"><span>7</span></span><span>].signal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>BIT_ADDRP</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>GPIOC</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span><span>IDR</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>9</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></div></pre>
<h2 id="3-5-">3.5 学码函数</h2>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>红外信号学码函数</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>irda_decode</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>ir_pst&nbsp;ir</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>&nbsp;</span><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>unsigned</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>char</span></span><span>&nbsp;lastStatus&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>ir</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>signal</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>用来保存上一次电平状态,&nbsp;以判断电平是否发生翻转</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>unsigned</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>short</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>wave&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;ir</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>token</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>指向用来存储波形长度数据的数组</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>for</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--storage syntax--type syntax--c"><span>unsigned</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>int</span></span><span>&nbsp;cnt&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span>;&nbsp;cnt&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&lt;</span></span><span>&nbsp;WAVE_SEGEMENT_LENGTH;&nbsp;cnt</span><span class="syntax--keyword syntax--operator syntax--increment syntax--c"><span>++</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>计数器递增,&nbsp;计数器的数值代表波形长度</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>if</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>lastStatus&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>!=</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>ir</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>signal</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>wave</span><span class="syntax--keyword syntax--operator syntax--increment syntax--c"><span>++</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;cnt;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>当发生电平跳转时保存当前计数并将指针指向波形数组的下一个元素</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>if</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>IR_ISOVERFLOW</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>wave,&nbsp;ir</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>token</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>如果遥控器按键未松开会导致多次发送红外信号</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_sendStr</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--string syntax--quoted syntax--double syntax--c"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--c"><span>&quot;</span></span><span class="syntax--constant syntax--character syntax--escape syntax--c"><span>\n</span><span>\r</span></span><span>波形数据溢出,&nbsp;请松开按键!</span><span class="syntax--constant syntax--character syntax--escape syntax--c"><span>\n</span><span>\r</span></span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--c"><span>&quot;</span></span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>return</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cnt&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>清空计数器以便于测量下一段波形长度</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lastStatus&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>ir</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>signal</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>delay_us</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>26</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;跳过38KHz载波信号的电平反转</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>wave&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;数据结束标志</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>unsigned</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>short</span></span><span>&nbsp;len&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;wave&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span>&nbsp;ir</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>token</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>计算波形的高电平和低电平共有多少段</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_sendStr</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--string syntax--quoted syntax--double syntax--c"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--c"><span>&quot;</span></span><span class="syntax--constant syntax--character syntax--escape syntax--c"><span>\n</span><span>\r</span></span><span>波形数组长度:&nbsp;</span><span class="syntax--constant syntax--character syntax--escape syntax--c"><span>\t</span></span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--c"><span>&quot;</span></span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>uart_short2char</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>len</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>在终端反馈数据</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>UART_CR</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div></pre>
<p>本次设计采用的学码方式是波形拷贝式, 也就是通过记录接收到的红外波形的低电平和高电平的电平宽度, 对红外信号进行完全的复制。</p>
<h2 id="3-6-">3.6 发码函数</h2>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>红外信号发码函数</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>void</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>irda_encode</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>ir_pst&nbsp;ir</span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>&nbsp;</span><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>unsigned</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>short</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>wave&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;ir</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>token</span></span><span>;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>定义一个指针指向被发送的波形数据</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>unsigned</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>short</span></span><span>&nbsp;cnt;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>计数器</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>while</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span><span>(</span></span><span>cnt&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>wave</span><span class="syntax--keyword syntax--operator syntax--increment syntax--c"><span>++</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span><span>)</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly syntax--c"><span>{</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>提取当前波形长度,&nbsp;如果长度值有效则将发送波形,&nbsp;并且将&nbsp;wave&nbsp;指向下一段数据</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>ir</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrPWM</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--bitwise syntax--c"><span>^=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>1</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>电平翻转,切换&nbsp;PWM&nbsp;输出状态,如果之前输出是打开的则关闭,&nbsp;如果之前是关闭的则打开</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--c"><span>while</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>cnt</span><span class="syntax--keyword syntax--operator syntax--decrement syntax--c"><span>--</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--c"><span class="syntax--entity syntax--name syntax--function syntax--c"><span>delay_us</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>26</span></span><span class="syntax--punctuation syntax--section syntax--arguments syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>计数器单位为&nbsp;20us,&nbsp;因为波形有38KHz载波</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>ir</span><span class="syntax--punctuation syntax--separator syntax--pointer-access syntax--c"><span>-&gt;</span></span><span class="syntax--variable syntax--other syntax--member syntax--c"><span>IrPWM</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span>;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>发码结束后关闭&nbsp;PWM&nbsp;输出</span></span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--meta syntax--block syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly syntax--c"><span>}</span></span></span></span></div></pre>
<p>**
发码函数中通过学码函数记录的数据, 对 PWM 进行打开和关闭来实现载波的发送。由于这里的计数器和学码电路中保存数据的时间单位同为 26 微秒, 所以发送的红外信号和接收到的红外信号几乎是完全相同的, 从而实现了红外信号的学码功能。</p>
<h1 id="4-">4. 总结</h1>
<h2 id="4-1-">4.1 本设计的软件使用说明</h2>
<h3 id="4-1-1-">4.1.1 软件开发环境</h3>
<p>本设计的软件系统环境为 Linux 系统, 使用了如下 GNU 工具:</p>
<ul>
<li>Makefile</li>
<li>arm-none-eabi-gcc</li>
<li>stm32flash (用来通过串口给单片机烧写程序)</li>
</ul>
<h3 id="4-1-2-">4.1.2 源码文件框架</h3>
<pre class="editor-colors lang-text"><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>├──&nbsp;Makefile</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>├──&nbsp;Makefile.common</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>├──&nbsp;libs</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>│&nbsp;&nbsp;&nbsp;├──&nbsp;Makefile</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>│&nbsp;&nbsp;&nbsp;├──&nbsp;STM32_USB-FS-Device_Lib_V4.0.0</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>│&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;&nbsp;├──&nbsp;Libraries</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>│&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;&nbsp;├──&nbsp;MCD-ST\&nbsp;Liberty\&nbsp;SW\&nbsp;License\&nbsp;Agreement\&nbsp;V2.pdf</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>│&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;&nbsp;├──&nbsp;Projects</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>│&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;&nbsp;├──&nbsp;Release_Notes.html</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>│&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;&nbsp;├──&nbsp;Utilities</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>│&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;&nbsp;└──&nbsp;_htmresc</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>│&nbsp;&nbsp;&nbsp;├──&nbsp;include</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>│&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;&nbsp;├──&nbsp;bit.h</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>│&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;&nbsp;├──&nbsp;irda.h</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>│&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;&nbsp;├──&nbsp;tty.h</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>│&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;&nbsp;└──&nbsp;uart.h</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>│&nbsp;&nbsp;&nbsp;└──&nbsp;source</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├──&nbsp;irda.c</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;└──&nbsp;uart.c</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>├──&nbsp;linker.ld</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>└──&nbsp;src</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--paragraph syntax--text"><span>├──&nbsp;Makefile</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&nbsp;&nbsp;&nbsp;&nbsp;├──&nbsp;main.c</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&nbsp;&nbsp;&nbsp;&nbsp;└──&nbsp;startup.c</span></span></span></div></pre><p>上面是本设计的源码文件结构, 其中有:</p>
<ul>
<li>Makefile - 用来实现整个项目的自动化编译, 以及代码的烧写</li>
<li>Makefile.common - Makefile 的配置文件, 类似于 C 语言中的头文件</li>
<li>libs/STM32_USB-FS-Device_Lib_V4.0.0 文件夹 - 里面存储了 stm32 官方的库</li>
<li>libs/include 文件夹 - 里面存储了本次设计的头文件 .h 文件</li>
<li>libs/source 文件夹 - 里面存储了本次设计的源码 .c 文件</li>
<li>linker.ld - 链接文件, 根据 stm32 RAM 和 Flash 的大小来定义, 编译时会通过该文件生成最终的二进制文件</li>
<li>src 文件夹 - 里面是本次设计的主函数源码以及单片机的启动代码</li>
</ul>
<h3 id="4-1-3-">4.1.3 软件使用说明</h3>
<p>首先要确保在终端中当前的目录为项目文件内, 可以使用 <code style="font-family: Menlo;">pwd</code> 命令查看当前路径, 使用 <code style="font-family: Menlo;">cd</code> 命令 (Change Directory) 来进入当前项目文件。</p>
<ul>
<li><code style="font-family: Menlo;">make</code> 命令: 用来编译整个工程, 并且在当前目录中生成二进制文件 main.bin</li>
<li><code style="font-family: Menlo;">make flash</code> 命令: 用来将二进制文件 main.bin 通过 USB 烧写到单片机</li>
<li><code style="font-family: Menlo;">make clean</code> 命令: 清除编译产生的中间文件和目标文件</li>
</ul>
<h2 id="4-2-">4.2 电路板的使用及功能演示</h2>
<h3 id="4-2-1-">4.2.1 烧写程序</h3>
<ol>
<li><p>按照 4.1.3 章节的软件说明, 使用 make 命令来生成用来被烧写的 main.bin 文件。</p>
</li>
<li><p>按照电路板的接口旁的丝印信息, 将其通过杜邦线连接 串口转 USB 模块:</p>
<ul>
<li>电路板的 <code style="font-family: Menlo;">+</code> 针脚连接串口转 USB 模块的 <code style="font-family: Menlo;">+5V</code></li>
<li>电路板的 <code style="font-family: Menlo;">-</code> 针脚连接串口转 USB 模块的 <code style="font-family: Menlo;">GND</code></li>
<li>电路板的 <code style="font-family: Menlo;">T</code> 针脚连接串口转 USB 模块的 <code style="font-family: Menlo;">RXD</code></li>
<li>电路板的 <code style="font-family: Menlo;">R</code> 针脚连接串口转 USB 模块的 <code style="font-family: Menlo;">TXD</code></li>
</ul>
</li>
<li><p>按照 2.2 章节的启动配置说明, 将电路板上的电阻 R3 右侧短接上方电容 C7 左侧, 然后再将串口转 USB 模块连接电脑, 此时单片机会运行其出厂自带的 ISP 程序(In System Program 在系统编程), 这样我们才能通过串口连接单片机来上传程序</p>
<p> <img src="/Users/but0n/GitHub/IrDA/Hardware/part_0202.png" alt=""></p>
</li>
<li><p>按照 4.1.3 章节的说明使用 make flash 命令来烧写程序, 如果看到这样的信息说明程序烧写成功:</p>
<p> <img src="/Users/but0n/GitHub/IrDA/Hardware/paper040201.png" alt=""></p>
</li>
</ol>
<h3 id="4-2-2-">4.2.2 功能演示</h3>
<p>在进行功能演示之前, 需要使用下列步骤在电路板和电脑之间建立串口通信:</p>
<ol>
<li><p>将已烧写过程序的两个电路板通过串口转 USB 模块分别连接到电脑</p>
</li>
<li><p>在终端键入 <code style="font-family: Menlo;">ls -al /dev/</code></p>
</li>
<li><p>在反馈的信息中寻找 <code style="font-family: Menlo;">tty.SLAB_USBtoUART</code> 和 <code style="font-family: Menlo;">tty.SLAB_USBtoUARTxxx</code> (xxx为若干个数字), 这两个设备分别对应着刚才连接的两个电路板。如果找到了这两个设备说明电路板已经成功连接。</p>
</li>
<li><p>在终端键入 <code style="font-family: Menlo;">screen /dev/设备名称 115200</code> 来建立串口通信</p>
</li>
</ol>
<p>这时我们就可以使用串口来控制单片机了:</p>
<p><img src="/Users/but0n/GitHub/IrDA/Hardware/debug_cmd.png" alt=""></p>
<p>上图是学码演示, 在这次演示中我们输入了两条指令, 从反馈的信息中我们不难看出其指令是支持同时控制多路外设的, 并且体现除了 $L 命令效果, 即对状态的切换。当我们按下遥控器上的按钮时单片机收到了红外信号并对信号波形进行记录, 以实现对波形的学习。</p>
<p><img src="/Users/but0n/GitHub/IrDA/Hardware/debug_OVERFLOW.png" alt=""></p>
<p>上图是该系统对错误操作的处理, 当用户长时间按住遥控器按键会造成红外信号的重复发送, 这时单片机会停止学码, 并反馈信息给用户, 维护了系统的稳健性。</p>
<p>在发码演示中我们通过两个电路板进行测试, 在这里我们分别称作电路板 A 和电路板 B , 首先打开 A 电路板的学码功能, 然后使用电视遥控器发一个信号给该电路板, 然后我们在打开另一个电路板 B 的学码功能, 这时使用 A 电路板的发码功能发送它所记录的遥控器信号给 B 电路板, 这时通过对比 A B 收到的信号数据来检查学码功能。</p>
<p>下面是实际的操作反馈：</p>
<p><img src="/Users/but0n/GitHub/IrDA/Hardware/debug_final.png" alt=""></p>
<p>上图为两个电路板的串口通信界面, 其中一个学习了电视遥控器所发出的信号, 然后将该信号发送给另一个电路板, 通过对比两组波形信号, 可以看到波形数据十分吻合, 误差极小, 完成了学码功能。</p>
<h1 id="5-">5. 参考资料</h1>
<ul>
<li>Cortex-M3 权威指南</li>
<li>STM32F10xxx参考手册</li>
<li><a href="http: //blog.sina.com.cn/s/blog_8a4745370102vq8m.html">4.23 STM32 外设篇-红外线接收工作原理及程序设计  此博文包含图片    (2015-06-10 15: 38: 33)</a></li>
<li><a href="http: //www.voidcn.com/blog/u012993936/article/p-3554521.html">浅谈38K红外发射接受编码</a></li>
<li><a href="http: //blog.csdn.net/u013686019/article/details/19834441">基于STM32的学习型通用红外遥控设备的设计实现(1~3)</a></li>
<li><a href="http: //www.ithao123.cn/content-8377076.html">STM32学习之路-AIRCR寄存器PRIGROUP位的配置</a></li>
<li><a href="http: //blog.csdn.net/u010173859/article/details/10179627"> STM32学习笔记: 外部中断EXTI的使用</a></li>
<li><a href="http: //blog.sina.com.cn/s/blog_6623834301018woa.html">STM32学习笔记之EXTI（外部中断）</a></li>
<li><a href="https: //wenku.baidu.com/view/4944282c915f804d2b16c18e.html">STM32中断优先级彻底讲解</a></li>
</ul></body>
</html>
